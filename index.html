<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FinFlow | Expense Tracker</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>
<body>
  <!-- Only one of these will be visible at a time -->
  <div id="authPage" class="auth-page" style="display: none;">
    <!-- Auth content will be loaded here by JavaScript -->
  </div>
  
  <div id="appContainer" style="display: none;">
    <!-- Main app content will be loaded here by JavaScript -->
  </div>

  <!-- Loading screen -->
  <div id="globalLoading" class="loading-overlay" style="display: flex;">
    <div class="loading-spinner"></div>
    <p>Loading FinFlow...</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Combined JavaScript file -->
  <script>
    // ================= CONFIGURATION =================
    let userId = null;
    let monthlyIncome = 0;
    let userCurrency = 'INR';
    let monthlyBudget = 0;
    let currentTheme = localStorage.getItem('theme') || 'light';

    // Data storage (will be loaded after auth)
    let expenses = [];
    let recurringExpenses = [];
    let billReminders = [];
    let splitExpenses = [];
    let customCategories = [];

    // Currency symbols
    const CURRENCY_SYMBOLS = {
        'INR': '‚Çπ',
        'USD': '$',
        'EUR': '‚Ç¨',
        'GBP': '¬£'
    };

    // Default categories
    const DEFAULT_CATEGORIES = [
        { name: 'Food', icon: 'üçî', color: '#4361ee' },
        { name: 'Transport', icon: 'üöó', color: '#3a0ca3' },
        { name: 'Bills', icon: 'üìÑ', color: '#7209b7' },
        { name: 'Shopping', icon: 'üõçÔ∏è', color: '#f72585' },
        { name: 'Entertainment', icon: 'üé¨', color: '#4cc9f0' },
        { name: 'Healthcare', icon: 'üè•', color: '#560bad' },
        { name: 'Education', icon: 'üìö', color: '#b5179e' },
        { name: 'Other', icon: 'üì¶', color: '#480ca8' }
    ];

    // ================= AUTHENTICATION =================
    function checkAuth() {
        const session = JSON.parse(localStorage.getItem('userSession') || sessionStorage.getItem('userSession'));
        
        if (session && session.isAuthenticated) {
            // Check if session is still valid (24 hours)
            const loginTime = new Date(session.loginTime);
            const now = new Date();
            const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
            
            if (hoursDiff < 24) {
                userId = session.userId;
                loadUserData(userId);
                loadApp();
                return true;
            } else {
                // Session expired
                localStorage.removeItem('userSession');
                sessionStorage.removeItem('userSession');
            }
        }
        
        loadAuth();
        return false;
    }

    function loadAuth() {
        document.getElementById('globalLoading').style.display = 'none';
        document.getElementById('authPage').style.display = 'block';
        
        // Load auth HTML
        document.getElementById('authPage').innerHTML = `
            <div class="auth-background">
                <div class="shape shape-1"></div>
                <div class="shape shape-2"></div>
                <div class="shape shape-3"></div>
            </div>

            <button class="theme-toggle-btn" onclick="toggleAuthTheme()" id="authThemeToggle">
                <i class="fas fa-moon" id="authThemeIcon"></i>
                <span>Theme</span>
            </button>

            <div class="auth-container">
                <div class="auth-card">
                    <div class="auth-header">
                        <div class="logo">
                            <div class="logo-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h2>FinFlow</h2>
                        </div>
                        <p class="auth-subtitle">Track your expenses, achieve your financial goals</p>
                    </div>

                    <div class="auth-error" id="authError"></div>

                    <div class="auth-tabs">
                        <button class="auth-tab active" onclick="showAuthForm('login')">
                            <i class="fas fa-sign-in-alt"></i>
                            <span>Login</span>
                        </button>
                        <button class="auth-tab" onclick="showAuthForm('register')">
                            <i class="fas fa-user-plus"></i>
                            <span>Register</span>
                        </button>
                    </div>

                    <!-- LOGIN FORM -->
                    <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                        <div class="input-group">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="loginEmail" placeholder="Email address" required />
                            <div class="input-focus-line"></div>
                        </div>

                        <div class="input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="loginPassword" placeholder="Password" required />
                            <button type="button" class="password-toggle" onclick="togglePassword('loginPassword', this)">
                                <i class="fas fa-eye"></i>
                            </button>
                            <div class="input-focus-line"></div>
                        </div>

                        <div class="auth-options">
                            <label class="checkbox-container">
                                <input type="checkbox" id="rememberMe" />
                                <span class="checkmark"></span>
                                Remember me
                            </label>
                            <a href="#" class="forgot-password" onclick="showForgotPassword()">Forgot password?</a>
                        </div>

                        <button type="submit" class="btn-primary auth-submit-btn">
                            <i class="fas fa-sign-in-alt"></i>
                            Sign In
                        </button>

                        <div class="demo-login">
                            <p class="demo-title">Demo Account (Try it out!)</p>
                            <button type="button" class="btn-secondary demo-btn" onclick="useDemoAccount()">
                                <i class="fas fa-user-secret"></i>
                                Login as Demo User
                            </button>
                            <p class="demo-note">Email: demo@finflow.com | Password: demo123</p>
                        </div>
                    </form>

                    <!-- REGISTER FORM -->
                    <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
                        <div class="input-group">
                            <i class="fas fa-user"></i>
                            <input type="text" id="registerName" placeholder="Full name" required />
                            <div class="input-focus-line"></div>
                        </div>

                        <div class="input-group">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="registerEmail" placeholder="Email address" required />
                            <div class="input-focus-line"></div>
                        </div>

                        <div class="input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="registerPassword" placeholder="Password" 
                                   oninput="checkPasswordStrength(this.value)"
                                   minlength="6" required />
                            <button type="button" class="password-toggle" onclick="togglePassword('registerPassword', this)">
                                <i class="fas fa-eye"></i>
                            </button>
                            <div class="input-focus-line"></div>
                        </div>

                        <div class="password-strength" id="passwordStrength">
                            <div class="strength-bar">
                                <div class="strength-fill" id="strengthFill"></div>
                            </div>
                            <div class="strength-text" id="strengthText">Password strength: None</div>
                        </div>

                        <div class="input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="registerConfirmPassword" placeholder="Confirm password" required />
                            <div class="input-focus-line"></div>
                        </div>

                        <div class="auth-options">
                            <label class="checkbox-container">
                                <input type="checkbox" id="acceptTerms" required />
                                <span class="checkmark"></span>
                                I agree to the <a href="#" class="terms-link">Terms & Conditions</a>
                            </label>
                        </div>

                        <button type="submit" class="btn-primary auth-submit-btn">
                            <i class="fas fa-user-plus"></i>
                            Create Account
                        </button>
                    </form>

                    <!-- FORGOT PASSWORD FORM -->
                    <form id="forgotPasswordForm" class="auth-form" onsubmit="handleForgotPassword(event)" style="display: none;">
                        <div class="input-group">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="resetEmail" placeholder="Enter your email" required />
                            <div class="input-focus-line"></div>
                        </div>

                        <button type="submit" class="btn-primary auth-submit-btn">
                            <i class="fas fa-paper-plane"></i>
                            Send Reset Link
                        </button>

                        <button type="button" class="btn-text" onclick="showAuthForm('login')" style="width: 100%; text-align: center; margin-top: 1rem;">
                            <i class="fas fa-arrow-left"></i>
                            Back to Login
                        </button>
                    </form>

                    <div class="auth-footer">
                        <p>By continuing, you agree to FinFlow's Terms of Service and Privacy Policy</p>
                        <div class="footer-links">
                            <a href="#">Help Center</a>
                            <a href="#">Privacy Policy</a>
                            <a href="#">Terms of Service</a>
                            <a href="#">Contact Us</a>
                        </div>
                    </div>
                </div>
            </div>

            <div id="authLoadingOverlay" class="auth-loading-overlay hidden">
                <div class="auth-loading-spinner"></div>
                <p>Loading...</p>
            </div>
        `;
        
        // Initialize auth functions
        initializeAuth();
    }

    function loadApp() {
        document.getElementById('globalLoading').style.display = 'none';
        document.getElementById('appContainer').style.display = 'block';
        
        // Load main app HTML
        document.getElementById('appContainer').innerHTML = `
            <div id="globalMessage" class="message"></div>

            <div class="app">
                <!-- SIDEBAR -->
                <aside class="sidebar">
                    <div class="sidebar-header">
                        <div class="logo">
                            <i class="fas fa-chart-line"></i>
                            <span class="logo-text">FinFlow</span>
                        </div>
                    </div>
                    
                    <div class="sidebar-nav">
                        <button class="nav-btn active" onclick="showSection('dashboard')">
                            <i class="fas fa-home"></i>
                            <span class="nav-text">Dashboard</span>
                        </button>
                        
                        <button class="nav-btn" onclick="showSection('expenses')">
                            <i class="fas fa-wallet"></i>
                            <span class="nav-text">Expenses</span>
                        </button>
                        
                        <button class="nav-btn" onclick="showSection('analytics')">
                            <i class="fas fa-chart-pie"></i>
                            <span class="nav-text">Analytics</span>
                        </button>
                        
                        <button class="nav-btn" onclick="showSection('recurring')">
                            <i class="fas fa-redo"></i>
                            <span class="nav-text">Recurring</span>
                        </button>
                        
                        <button class="nav-btn" onclick="showSection('bills')">
                            <i class="fas fa-bell"></i>
                            <span class="nav-text">Bill Reminders</span>
                        </button>
                        
                        <button class="nav-btn" onclick="showSection('split')">
                            <i class="fas fa-users"></i>
                            <span class="nav-text">Split Expenses</span>
                        </button>
                    </div>
                    
                    <div class="sidebar-footer">
                        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                            <i class="fas fa-moon" id="themeIcon"></i>
                            <span class="nav-text">Theme</span>
                        </button>
                        
                        <button class="profile-btn" onclick="toggleProfile()">
                            <i class="fas fa-user-circle"></i>
                            <span class="nav-text">Profile</span>
                        </button>
                        
                        <button class="switch-account-btn" onclick="switchAccount()">
                            <i class="fas fa-exchange-alt"></i>
                            <span class="nav-text">Switch Account</span>
                        </button>
                        
                        <button class="logout-btn" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span class="nav-text">Logout</span>
                        </button>
                    </div>
                </aside>
                
                <!-- MAIN CONTENT -->
                <main class="main">
                    <header class="main-header">
                        <div class="header-left">
                            <h1 id="username" class="animate__animated animate__fadeIn">Welcome to FinFlow</h1>
                            <p class="subtitle">Track your expenses, achieve your financial goals</p>
                        </div>
                        <div class="header-right">
                            <div class="currency-selector">
                                <select id="currencySelector" onchange="changeCurrency(this.value)">
                                    <option value="INR">‚Çπ INR</option>
                                    <option value="USD">$ USD</option>
                                    <option value="EUR">‚Ç¨ EUR</option>
                                    <option value="GBP">¬£ GBP</option>
                                </select>
                            </div>
                            <div class="date-display" id="currentDate"></div>
                            <button class="btn-primary" onclick="toggleProfile()">
                                <i class="fas fa-user-cog"></i> Profile
                            </button>
                        </div>
                    </header>

                    <!-- SECTIONS WILL BE LOADED DYNAMICALLY -->
                    <div id="mainSections"></div>
                </main>
            </div>

            <!-- MODALS WILL BE LOADED DYNAMICALLY -->
            <div id="modalsContainer"></div>

            <!-- Loading Overlay -->
            <div id="loadingOverlay" class="loading-overlay hidden">
                <div class="loading-spinner"></div>
                <p>Loading...</p>
            </div>
        `;
        
        // Initialize main app
        initializeApp();
    }

    // ================= SIMPLIFIED VERSION =================
    // Since this is getting long, I'll give you the SIMPLE solution:
    
    // Create this folder structure:
    // - index.html (SIMPLE redirect page)
    // - app.html (your main app)
    // - login.html (your auth page)
    
    // In index.html:
    <!DOCTYPE html>
    <html>
    <head>
        <title>FinFlow - Redirecting</title>
        <script>
            // Check if user is logged in
            const session = JSON.parse(localStorage.getItem('userSession') || sessionStorage.getItem('userSession'));
            
            if (session && session.isAuthenticated) {
                // Check if session is valid (24 hours)
                const loginTime = new Date(session.loginTime);
                const now = new Date();
                const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
                
                if (hoursDiff < 24) {
                    window.location.href = 'app.html';
                } else {
                    // Session expired
                    localStorage.removeItem('userSession');
                    sessionStorage.removeItem('userSession');
                    window.location.href = 'login.html';
                }
            } else {
                window.location.href = 'login.html';
            }
        </script>
    </head>
    <body>
        <p>Redirecting to FinFlow...</p>
    </body>
    </html>
  </script>
</body>
</html>
